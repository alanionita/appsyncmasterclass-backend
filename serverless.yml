service: appsyncmasterclass-backend
frameworkVersion: "3"

plugins:
  - serverless-appsync-plugin

provider:
  name: aws
  runtime: nodejs20.x
  region: eu-west-2 

package:
  exclude: 
    - package-lock.json
    - package.json

appSync: ${file(./serverless/appsync.yml)}

# you can add CloudFormation resource templates here
resources:
  Resources:
    CognitoUserPool:
      Type: AWS::Cognito::UserPool
      Properties:
        AutoVerifiedAttributes:
          - email
        Policies:
          PasswordPolicy:
            MinimumLength: 8
            RequireNumbers: true
            RequireUppercase: true
            RequireSymbols: true
            RequireLowercase: false
        UsernameAttributes:
          - email
        Schema:
          - AttributeDataType: String
            Name: name  
            Required: false
            Mutable: true
    WebUserPoolClient:
        Type: AWS::Cognito::UserPoolClient
        Properties:
            UserPoolId: !Ref CognitoUserPool
            ClientName: web
            PreventUserExistenceErrors: ENABLED
            ExplicitAuthFlows:
              - ALLOW_USER_SRP_AUTH
              - ALLOW_USER_PASSWORD_AUTH
              - ALLOW_REFRESH_TOKEN_AUTH
  Outputs:
    CognitoUserPoolId:
      Description: "Cognito User Pool ::"
      Value: !Ref CognitoUserPool
