scenarios:
  - flow:
      - log: "Scenario: post tweet to timeline"
      - log: "START..."
      - log: "Step: 1. get profile"
      - post:
          url: /
          headers:
            Authorization: "Bearer {{ idToken }}"
          json:
            query: "query getMyProfile {
              getMyProfile {
                id
                name
                screenName
                bio
                createdAt
                birthdate
              }  
            }"
          expect:
            - statusCode: 200
      - log: "Step: 2. post tweet"
      - post:
          url: /
          headers:
            Authorization: "Bearer {{ idToken }}"
          json:
            query: "mutation tweet($text: String!) {
              tweet(text: $text) {
                createdAt
                id
                liked
                likes
                profile {
                  id
                  name
                  screenName
                }
                replies
                retweeted
                retweets
                text
              }  
            }"
            variables:
              text: this is a tweet
          expect:
            - statusCode: 200
            - hasProperty: data.tweet.id
      - log: "Step: 3. load timeline"
      - post:
          url: /
          headers:
            Authorization: "Bearer {{ idToken }}"
          json:
            query: "query getMyTimeline {
                getMyTimeline(limit:25) {
                  nextToken
                  tweets {
                    id
                    profile {
                      id
                      name
                      screenName
                    }
                    ... on Tweet {
                      text
                      likes
                      replies
                      retweets
                    }
                    ... on Retweet {
                      retweetOf {
                        id
                        profile {
                          id
                          name
                          screenName
                        }
                        ... on Tweet {
                          id
                          text
                        }
                      }
                    }
                    ... on Reply {
                      text
                      inReplyToUsers {
                        id
                        name
                        screenName
                      }
                      inReplyToTweet {
                        id
                        profile {
                          id
                          name
                          screenName
                        }
                        ... on Tweet {
                          id
                          text
                        }
                      }
                    }
                  }
                }  
              }"
          expect:
            - statusCode: 200